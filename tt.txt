<template>
  <div class="app-container">
    <el-card class="search-card" shadow="never">
      <el-form :inline="true" :model="queryParams" ref="queryFormRef">
        <el-form-item label="交易编号" prop="transactionNo">
          <el-input v-model="queryParams.transactionNo" placeholder="请输入交易编号" clearable @keyup.enter="handleQuery" />
        </el-form-item>
        <el-form-item label="客户姓名" prop="customerName">
          <el-input v-model="queryParams.customerName" placeholder="请输入客户姓名" clearable @keyup.enter="handleQuery" />
        </el-form-item>
        <el-form-item label="交易状态" prop="status">
          <el-select v-model="queryParams.status" placeholder="全部" clearable style="width: 150px">
            <el-option v-for="(label, value) in TransactionStatusMap" :key="value" :label="label" :value="Number(value)" />
          </el-select>
        </el-form-item>
        <el-form-item>
          <el-button type="primary" :icon="Search" @click="handleQuery">搜索</el-button>
          <el-button :icon="Refresh" @click="resetQuery">重置</el-button>
        </el-form-item>
      </el-form>
    </el-card>

    <el-card class="table-card" shadow="never">
      <template #header>
        <div class="card-header">
          <span class="title">交易列表</span>
          <div class="btns">
            <el-button type="primary" :icon="Plus" plain @click="handleAdd">新建交易</el-button>
          </div>
        </div>
      </template>

      <el-table v-loading="loading" :data="tableData" border stripe highlight-current-row>
        <el-table-column type="index" label="序号" width="60" align="center" />
        <el-table-column prop="transactionNo" label="交易编号" min-width="140" show-overflow-tooltip />
        <el-table-column prop="houseNo" label="房源编号" width="120" show-overflow-tooltip />
        <el-table-column prop="unitName" label="户型" width="120" show-overflow-tooltip />
        <el-table-column prop="customerName" label="客户姓名" width="100" />
        <el-table-column prop="salesName" label="销售顾问" width="100" />
        <el-table-column prop="dealPrice" label="成交价格" min-width="120" align="right">
          <template #default="scope">
            {{ formatCurrency(scope.row.dealPrice) }}
          </template>
        </el-table-column>
        <el-table-column prop="status" label="交易状态" width="110" align="center">
          <template #default="scope">
            <el-tag :type="getStatusTag(scope.row.status)">{{ getDisplayStatusText(scope.row) }}</el-tag>
          </template>
        </el-table-column>
        <el-table-column prop="managerAudit" label="审核" width="100" align="center">
          <template #default="scope">
            <el-tag effect="plain" :type="getAuditTag(scope.row.managerAudit)">{{ AuditStatusMap[scope.row.managerAudit] || '未知' }}</el-tag>
          </template>
        </el-table-column>
        <el-table-column prop="createTime" label="创建时间" width="160" />
        <el-table-column label="操作" width="160" fixed="right" align="center">
          <template #default="scope">
            <div style="display: flex; align-items: center; justify-content: center; gap: 8px;">
              <el-tooltip content="详情" placement="top">
                <el-button link type="primary" :icon="View" @click="handleDetail(scope.row)" />
              </el-tooltip>
              <el-tooltip content="编辑" placement="top">
                <el-button link type="primary" :icon="Edit" @click="handleEdit(scope.row)" />
              </el-tooltip>
            </div>
          </template>
        </el-table-column>
      </el-table>

      <div class="pagination-container">
        <el-pagination
          v-model:current-page="queryParams.pageNum"
          v-model:page-size="queryParams.pageSize"
          :total="total"
          :page-sizes="[10, 20, 50, 100]"
          layout="total, sizes, prev, pager, next, jumper"
          @size-change="getList"
          @current-change="getList"
        />
      </div>
    </el-card>

    <el-dialog v-model="detailVisible" title="交易详情" width="700px" append-to-body>
      <el-descriptions :column="2" border>
        <el-descriptions-item label="交易编号">{{ detailData.transactionNo }}</el-descriptions-item>
        <el-descriptions-item label="房源编号">{{ detailData.houseNo }}</el-descriptions-item>
        <el-descriptions-item label="客户姓名">{{ detailData.customerName }}</el-descriptions-item>
        <el-descriptions-item label="客户电话">{{ detailData.customerPhone }}</el-descriptions-item>
        <el-descriptions-item label="销售顾问">{{ detailData.salesName }}</el-descriptions-item>
        <el-descriptions-item label="创建时间">{{ detailData.createTime }}</el-descriptions-item>
        <el-descriptions-item label="成交价格"><span class="text-price">{{ formatCurrency(detailData.dealPrice) }}</span></el-descriptions-item>
        <el-descriptions-item label="定金金额">{{ formatCurrency(detailData.deposit) }}</el-descriptions-item>
        <el-descriptions-item label="首付金额">{{ formatCurrency(detailData.downPayment) }}</el-descriptions-item>
        <el-descriptions-item label="贷款金额">{{ formatCurrency(detailData.loanAmount) }}</el-descriptions-item>
        <el-descriptions-item label="交易状态"><el-tag :type="getStatusTag(detailData.status)">{{ TransactionStatusMap[detailData.status] || '未知' }}</el-tag></el-descriptions-item>
        <el-descriptions-item label="贷款状态"><el-tag effect="plain" :type="getLoanTag(detailData.loanStatus)">{{ LoanStatusMap[detailData.loanStatus] || '未知' }}</el-tag></el-descriptions-item>
        <el-descriptions-item label="经理审核" :span="2"><el-tag :type="getAuditTag(detailData.managerAudit)">{{ AuditStatusMap[detailData.managerAudit] || '未知' }}</el-tag></el-descriptions-item>
      </el-descriptions>
    </el-dialog>

    <el-dialog v-model="editVisible" title="编辑交易信息" width="650px" append-to-body destroy-on-close>
      <el-form :model="editForm" ref="editFormRef" :rules="rules" label-width="110px">
        <el-form-item label="交易编号">
          <el-input v-model="editForm.transactionNo" disabled />
        </el-form-item>

        <el-row :gutter="16">
          <el-col :span="12">
            <el-form-item label="成交价格" prop="dealPrice">
              <el-input-number v-model="editForm.dealPrice" :min="0" :precision="2" :controls="false" style="width: 100%" :disabled="!canEditDealPrice || isFinalLocked">
                <template #prefix>￥</template>
              </el-input-number>
            </el-form-item>
          </el-col>
          <el-col :span="12">
            <el-form-item label="定金金额" prop="deposit">
              <el-input-number v-model="editForm.deposit" :min="0" :precision="2" :controls="false" style="width: 100%" :disabled="!canEditFinanceFields || isFinalLocked" />
            </el-form-item>
          </el-col>
        </el-row>

        <el-row :gutter="16">
          <el-col :span="12">
            <el-form-item label="首付金额" prop="downPayment">
              <el-input-number v-model="editForm.downPayment" :min="0" :precision="2" :controls="false" style="width: 100%" :disabled="!canEditFinanceFields || isFinalLocked" />
            </el-form-item>
          </el-col>
          <el-col :span="12">
            <el-form-item label="贷款金额" prop="loanAmount">
              <el-input-number v-model="editForm.loanAmount" :min="0" :precision="2" :controls="false" style="width: 100%" :disabled="!canEditFinanceFields || isFinalLocked" />
            </el-form-item>
          </el-col>
        </el-row>

        <el-form-item label="贷款状态" prop="loanStatus">
          <el-select v-model="editForm.loanStatus" placeholder="请选择" style="width: 100%" :disabled="!canEditFinanceFields || isFinalLocked">
            <el-option v-for="(label, val) in LoanStatusMap" :key="val" :label="label" :value="Number(val)" />
          </el-select>
        </el-form-item>

        <el-divider content-position="left">状态流转</el-divider>

        <el-form-item v-if="roleType === 1" label="交易状态" prop="status">
          <el-radio-group v-model="editForm.status" :disabled="isFinalLocked">
            <el-radio-button :value="0">待定金</el-radio-button>
            <el-radio-button :value="1">已定金</el-radio-button>
            <el-radio-button :value="2">已首付</el-radio-button>
            <el-radio-button :value="3">已过户</el-radio-button>
            <el-radio-button :value="4">已完成</el-radio-button>
            <el-radio-button :value="5">已取消</el-radio-button>
          </el-radio-group>
        </el-form-item>

        <el-form-item v-if="roleType === 1" label="经理审核" prop="managerAudit">
          <el-radio-group v-model="editForm.managerAudit" :disabled="isFinalLocked">
            <el-radio-button :value="0">待审核</el-radio-button>
            <el-radio-button :value="1">通过</el-radio-button>
            <el-radio-button :value="2">驳回</el-radio-button>
          </el-radio-group>
        </el-form-item>

        <el-form-item v-if="roleType === 3 && editForm.status === 0 && editForm.managerAudit === 0" label="经理审核">
          <el-button type="success" plain @click="submitManagerApprove(true)">通过</el-button>
          <el-button type="danger" plain @click="submitManagerApprove(false)">驳回</el-button>
        </el-form-item>

        <el-form-item v-if="roleType === 4 && canFinanceApplyFinish" label="财务确认">
          <el-button type="primary" plain @click="submitFinanceApplyFinish">申请完成</el-button>
        </el-form-item>

        <el-form-item v-if="roleType === 4 && isFinishAuditPending" label="财务确认">
          <el-tag type="warning">待管理员审核</el-tag>
        </el-form-item>

        <el-form-item v-if="roleType === 1 && isFinishAuditPending" label="完成审核">
          <el-button type="success" plain @click="submitAdminFinishApprove(true)">通过</el-button>
          <el-button type="danger" plain @click="submitAdminFinishApprove(false)">驳回</el-button>
        </el-form-item>

        <el-divider content-position="left">佣金</el-divider>

        <el-form-item v-if="commissionInfo" label="佣金状态">
          <el-tag :type="commissionInfo.status === 2 ? 'success' : (commissionInfo.status === 1 ? 'warning' : 'info')">
            {{ CommissionStatusMap[commissionInfo.status] || '未知' }}
          </el-tag>
        </el-form-item>
        <el-form-item v-if="commissionInfo" label="佣金金额">
          <span class="text-price">{{ formatCurrency(commissionInfo.amount) }}</span>
        </el-form-item>

        <el-form-item v-if="canCreateCommission" label="提成比例(%)">
          <div style="display: flex; align-items: center; gap: 12px;">
            <el-input-number v-model="commissionRateInput" :min="0" :precision="2" :controls="false" style="width: 140px" />
            <el-button type="primary" plain :loading="commissionCreating" @click="submitCreateCommission">生成佣金</el-button>
          </div>
        </el-form-item>
      </el-form>
      <template #footer>
        <el-button @click="editVisible = false">取 消</el-button>
        <el-button type="primary" @click="submitEdit" :loading="submitLoading" :disabled="isFinalLocked">确 定</el-button>
      </template>
    </el-dialog>

    <el-dialog v-model="addVisible" title="新建交易" width="650px" append-to-body destroy-on-close>
      <el-form :model="addForm" ref="addFormRef" :rules="addRules" label-width="110px">
        <el-form-item label="选择房源" prop="houseId">
          <el-select v-model="addForm.houseId" placeholder="请选择房源" filterable style="width: 100%">
            <el-option v-for="item in houseOptions" :key="item.id" :label="item.houseNo" :value="item.id" />
          </el-select>
        </el-form-item>
        <el-form-item label="选择客户" prop="customerId">
          <el-select v-model="addForm.customerId" placeholder="请选择客户" filterable style="width: 100%">
            <el-option v-for="item in customerOptions" :key="item.id" :label="item.realName" :value="item.id" />
          </el-select>
        </el-form-item>
        <el-form-item label="销售顾问" prop="salesId">
          <el-select v-model="addForm.salesId" placeholder="请选择销售" filterable style="width: 100%" :disabled="roleType === 2">
            <el-option v-for="item in salesOptions" :key="item.id" :label="item.realName" :value="item.id" />
          </el-select>
        </el-form-item>
        <el-form-item label="成交价格" prop="dealPrice">
          <el-input-number v-model="addForm.dealPrice" :min="0" :precision="2" :controls="false" style="width: 100%">
            <template #prefix>￥</template>
          </el-input-number>
        </el-form-item>
      </el-form>
      <template #footer>
        <el-button @click="addVisible = false">取 消</el-button>
        <el-button type="primary" @click="submitAdd" :loading="addLoading">确 定</el-button>
      </template>
    </el-dialog>
  </div>
</template>

<script setup lang="ts">
import { ref, reactive, onMounted, nextTick, computed } from 'vue'
import { ElMessage, type FormInstance } from 'element-plus'
import { View, Edit, Search, Refresh, Plus } from '@element-plus/icons-vue'
import { useUserStore } from '@/stores/userStore'
import { reqTransactionList, reqGetTransactionDetail, reqUpdateTransaction, reqAddTransaction, reqManagerApprove, reqFinanceApplyFinish, reqAdminFinishApprove, reqFinanceConfirm } from '@/api/transaction'
import type { TransactionQuery, TransactionVO, TransactionForm, TransactionAddDTO } from '@/api/transaction/type'
import { getCustomerList, getHouseList, getSalesList } from '@/api/appointment'
import { reqGetCommissionByTransaction, reqCreateCommissionByTransaction } from '@/api/commission'
import type { CommissionVO } from '@/api/commission/type'

const userStore = useUserStore()
const roleType = computed(() => userStore.userInfo?.roleType)

const canEditDealPrice = computed(() => roleType.value === 1 || roleType.value === 2 || roleType.value === 3)
const canEditFinanceFields = computed(() => roleType.value === 1 || roleType.value === 4)

const TransactionStatusMap: Record<number, string> = { 0: '待付定金', 1: '已付定金', 2: '已付首付', 3: '已过户', 4: '已完成', 5: '已取消' }
const LoanStatusMap: Record<number, string> = { 0: '未申请', 1: '审核中', 2: '已放款', 3: '未通过' }
const AuditStatusMap: Record<number, string> = { 0: '待审核', 1: '已通过', 2: '已驳回' }
const FinishAuditMap: Record<number, string> = { 0: '未申请', 1: '待审核', 2: '已通过', 3: '已驳回' }

const loading = ref(false)
const total = ref(0)
const tableData = ref<TransactionVO[]>([])
const queryFormRef = ref<FormInstance>()

const queryParams = reactive<TransactionQuery>({
  pageNum: 1,
  pageSize: 10,
  transactionNo: '',
  customerName: '',
  status: undefined
})

const detailVisible = ref(false)
const detailData = reactive<any>({})

const editVisible = ref(false)
const submitLoading = ref(false)
const editFormRef = ref<FormInstance>()
const editForm = reactive<TransactionForm>({
  id: 0,
  transactionNo: '',
  dealPrice: 0,
  deposit: 0,
  downPayment: 0,
  loanAmount: 0,
  loanStatus: 0,
  status: 0,
  managerAudit: 0,
  finishAudit: 0
})

const isPaidOff = computed(() => {
  const dealPrice = Number(editForm.dealPrice || 0)
  const paid = Number(editForm.deposit || 0) + Number(editForm.downPayment || 0) + Number(editForm.loanAmount || 0)
  return dealPrice > 0 && paid + 0.0001 >= dealPrice
})

const isFinishAuditPending = computed(() => Number(editForm.finishAudit ?? 0) === 1)

const canFinanceApplyFinish = computed(() => {
  if (roleType.value !== 4) return false
  if (!(editForm.status === 2 || editForm.status === 3)) return false
  const fa = Number(editForm.finishAudit ?? 0)
  if (fa === 1 || fa === 2) return false
  return isPaidOff.value
})

const commissionInfo = ref<CommissionVO | null>(null)
const commissionRateInput = ref<number>(1)
const commissionCreating = ref(false)

const isFinalLocked = computed(() => editForm.status === 4 && Number(editForm.finishAudit ?? 0) === 2)

const canCreateCommission = computed(() => {
  if (!(roleType.value === 1 || roleType.value === 4)) return false
  if (editForm.status !== 4) return false
  if (Number(editForm.finishAudit ?? 0) !== 2) return false
  return !commissionInfo.value
})

const CommissionStatusMap: Record<number, string> = { 0: '待核算', 1: '已核算', 2: '已发放' }

const getDisplayStatusText = (row: TransactionVO) => {
  const fa = Number((row as any).finishAudit ?? 0)
  if ((row.status === 2 || row.status === 3) && fa === 1) {
    return '待审核'
  }
  if ((row.status === 2 || row.status === 3) && fa === 3) {
    return '已驳回'
  }
  return TransactionStatusMap[row.status] || '未知'
}

const rules = {
  dealPrice: [{ required: true, message: '成交价格不能为空', trigger: 'blur' }]
}

const addVisible = ref(false)
const addLoading = ref(false)
const addFormRef = ref<FormInstance>()
const addForm = reactive<TransactionAddDTO>({
  houseId: undefined as any,
  customerId: undefined as any,
  salesId: undefined as any,
  dealPrice: 0,
  deposit: 0,
  depositTime: undefined,
  downPayment: 0,
  downPaymentTime: undefined,
  loanAmount: 0,
  loanStatus: 0
})

const addRules = {
  houseId: [{ required: true, message: '请选择房源', trigger: 'change' }],
  customerId: [{ required: true, message: '请选择客户', trigger: 'change' }],
  salesId: [{ required: true, message: '请选择销售', trigger: 'change' }],
  dealPrice: [{ required: true, message: '请输入成交价格', trigger: 'blur' }]
}

const customerOptions = ref<any[]>([])
const houseOptions = ref<any[]>([])
const salesOptions = ref<any[]>([])

const formatCurrency = (value?: number | null) => {
  if (value === undefined || value === null) return '-'
  return `¥ ${Number(value).toLocaleString()}`
}

const getStatusTag = (status: number) => {
  const map: Record<number, string> = { 0: 'info', 1: 'warning', 2: 'primary', 3: 'primary', 4: 'success', 5: 'danger' }
  return map[status] || 'info'
}

const getAuditTag = (status: number) => {
  const map: Record<number, string> = { 0: 'info', 1: 'success', 2: 'danger' }
  return map[status] || 'info'
}

const getLoanTag = (status: number) => {
  const map: Record<number, string> = { 0: 'info', 1: 'warning', 2: 'success', 3: 'danger' }
  return map[status] || 'info'
}

const getList = async () => {
  loading.value = true
  try {
    const res: any = await reqTransactionList(queryParams)
    if (res && res.code === 200 && res.data) {
      tableData.value = res.data.records || []
      total.value = res.data.total || 0
    } else {
      tableData.value = []
      total.value = 0
    }
  } finally {
    loading.value = false
  }
}

const handleQuery = () => {
  queryParams.pageNum = 1
  getList()
}

const resetQuery = () => {
  queryFormRef.value?.resetFields()
  queryParams.status = undefined
  handleQuery()
}

const handleDetail = async (row: TransactionVO) => {
  const res: any = await reqGetTransactionDetail(row.id)
  if (res && res.code === 200 && res.data) {
    Object.assign(detailData, res.data)
    detailVisible.value = true
  }
}

const handleEdit = async (row: TransactionVO) => {
  const res: any = await reqGetTransactionDetail(row.id)
  if (res && res.code === 200 && res.data) {
    const data = res.data

    editForm.id = data.id
    editForm.transactionNo = data.transactionNo
    editForm.dealPrice = data.dealPrice || 0
    editForm.deposit = data.deposit || 0
    editForm.downPayment = data.downPayment || 0
    editForm.loanAmount = data.loanAmount || 0
    editForm.loanStatus = data.loanStatus ?? 0
    editForm.status = data.status ?? 0
    editForm.managerAudit = data.managerAudit ?? 0
    editForm.finishAudit = data.finishAudit ?? 0

    commissionInfo.value = null
    try {
      const cRes: any = await reqGetCommissionByTransaction(editForm.id)
      if (cRes && cRes.code === 200) {
        commissionInfo.value = cRes.data || null
      }
    } catch {
    }

    editVisible.value = true
    nextTick(() => editFormRef.value?.clearValidate())
  }
}

const submitCreateCommission = async () => {
  if (!canCreateCommission.value) return
  commissionCreating.value = true
  try {
    const res: any = await reqCreateCommissionByTransaction(editForm.id, commissionRateInput.value)
    if (res && res.code === 200) {
      ElMessage.success(res.message || '生成成功')
      const cRes: any = await reqGetCommissionByTransaction(editForm.id)
      if (cRes && cRes.code === 200) {
        commissionInfo.value = cRes.data || null
      }
    }
  } finally {
    commissionCreating.value = false
  }
}

const submitEdit = async () => {
  if (isFinalLocked.value) {
    ElMessage.warning('交易已完成且已通过完成审核，禁止修改')
    return
  }
  if (!editFormRef.value) return
  await editFormRef.value.validate(async (valid) => {
    if (!valid) return

    submitLoading.value = true
    try {
      const payload: any = { id: editForm.id }
      if (roleType.value === 2 || roleType.value === 3) {
        payload.dealPrice = editForm.dealPrice
      } else if (roleType.value === 4) {
        payload.deposit = editForm.deposit
        payload.downPayment = editForm.downPayment
        payload.loanAmount = editForm.loanAmount
        payload.loanStatus = editForm.loanStatus
      } else {
        Object.assign(payload, editForm)
      }

      const res: any = await reqUpdateTransaction(payload)
      if (res && res.code === 200) {
        ElMessage.success('更新成功')
        editVisible.value = false
        getList()
      }
    } finally {
      submitLoading.value = false
    }
  })
}

const submitManagerApprove = async (approved: boolean) => {
  const res: any = await reqManagerApprove(editForm.id, approved)
  if (res && res.code === 200) {
    ElMessage.success('操作成功')
    editVisible.value = false
    getList()
  }
}

const submitFinanceApplyFinish = async () => {
  try {
    const payload: any = { id: editForm.id }
    payload.deposit = editForm.deposit
    payload.downPayment = editForm.downPayment
    payload.loanAmount = editForm.loanAmount
    payload.loanStatus = editForm.loanStatus

    const saveRes: any = await reqUpdateTransaction(payload)
    if (!saveRes || saveRes.code !== 200) {
      return
    }

    const res: any = await reqFinanceApplyFinish(editForm.id)
    if (res && res.code === 200) {
      ElMessage.success('操作成功')
      editVisible.value = false
      getList()
    }
  } catch (e: any) {
    const status = e?.response?.status
    if (status === 404) {
      try {
        const res: any = await reqFinanceConfirm(editForm.id, true)
        if (res && res.code === 200) {
          ElMessage.success('操作成功')
          editVisible.value = false
          getList()
        }
      } catch {
      }
      return
    }
  }
}

const submitAdminFinishApprove = async (approved: boolean) => {
  const res: any = await reqAdminFinishApprove(editForm.id, approved)
  if (res && res.code === 200) {
    ElMessage.success('操作成功')
    getList()
    try {
      const dRes: any = await reqGetTransactionDetail(editForm.id)
      if (dRes && dRes.code === 200 && dRes.data) {
        const data = dRes.data
        editForm.transactionNo = data.transactionNo
        editForm.dealPrice = data.dealPrice || 0
        editForm.deposit = data.deposit || 0
        editForm.downPayment = data.downPayment || 0
        editForm.loanAmount = data.loanAmount || 0
        editForm.loanStatus = data.loanStatus ?? 0
        editForm.status = data.status ?? 0
        editForm.managerAudit = data.managerAudit ?? 0
        editForm.finishAudit = data.finishAudit ?? 0

        commissionInfo.value = null
        try {
          const cRes: any = await reqGetCommissionByTransaction(editForm.id)
          if (cRes && cRes.code === 200) {
            commissionInfo.value = cRes.data || null
          }
        } catch {
        }
      }
    } catch {
    }
  }
}

const loadOptions = async () => {
  try {
    const [cRes, hRes, sRes] = await Promise.all([getCustomerList(), getHouseList(), getSalesList()])
    if (cRes?.code === 200) customerOptions.value = cRes.data?.records || []
    if (hRes?.code === 200) houseOptions.value = hRes.data?.list || hRes.data?.records || []
    if (sRes?.code === 200) salesOptions.value = Array.isArray(sRes.data) ? sRes.data : (sRes.data?.records || [])
  } catch {
  }
}

const handleAdd = async () => {
  addForm.houseId = undefined as any
  addForm.customerId = undefined as any
  addForm.salesId = undefined as any
  addForm.dealPrice = 0

  if (roleType.value === 2) {
    addForm.salesId = userStore.userInfo?.userId as any
  }

  await loadOptions()
  addVisible.value = true
  nextTick(() => addFormRef.value?.clearValidate())
}

const submitAdd = async () => {
  if (!addFormRef.value) return
  await addFormRef.value.validate(async (valid) => {
    if (!valid) return
    addLoading.value = true
    try {
      const res: any = await reqAddTransaction(addForm)
      if (res && res.code === 200) {
        ElMessage.success('新建交易成功')
        addVisible.value = false
        getList()
      }
    } finally {
      addLoading.value = false
    }
  })
}

onMounted(() => {
  getList()
})
</script>

<style scoped lang="scss">
.app-container {
  padding: 20px;
}

.search-card {
  margin-bottom: 20px;
}

.table-card {
  min-height: 500px;

  .card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;

    .title {
      font-weight: bold;
      font-size: 16px;
    }
  }
}

.pagination-container {
  margin-top: 20px;
  display: flex;
  justify-content: flex-end;
}

.text-price {
  color: #f56c6c;
  font-weight: bold;
}

.radio-success {
  :deep(.el-radio__input.is-checked + .el-radio__label) {
    color: #67c23a;
  }

  :deep(.el-radio__input.is-checked .el-radio__inner) {
    border-color: #67c23a;
    background: #67c23a;
  }
}

.radio-danger {
  :deep(.el-radio__input.is-checked + .el-radio__label) {
    color: #f56c6c;
  }

  :deep(.el-radio__input.is-checked .el-radio__inner) {
    border-color: #f56c6c;
    background: #f56c6c;
  }
}
</style>